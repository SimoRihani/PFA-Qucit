<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="post-service/post-service.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">
<link rel="import" href="./post-card.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-fab/paper-fab.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/iron-icons/maps-icons.html">

<dom-module id="post-list">
  <style>
    /* TODO(polyup): For speed, consider reworking these styles with .classes
                     and #ids rather than [attributes].
    */
    [layout] {
      @apply(--layout);
    }
    [layout][vertical] {
      @apply(--layout-vertical);
    }
    [layout][center] {
      @apply(--layout-center);
    }
  </style>
  <style>
    :host {
      display: block;
      width: 100%;
    }
    post-card {
      margin-bottom: 4px;
      margin-top: 4px;
    }
    #connectionicon {
      color: #636363;
      width: 52%;
    }
    #alert {
      position: absolute;
      bottom: 3px;
      right: 3px;
      color: #da4336;
    }
    #connectionicon:active {
      color: #da4336;
    }
    :host([connection]) #connectionicon {
      color: #da4336;
    }
    
    paper-progress::shadow #activeProgress {
     background-color: red;
    }
    paper-progress::shadow #secondaryProgress {
     background-color: purple;
    }
    paper-progress::shadow #progressContainer {
     background-color: #64ffda;
    }
    paper-spinner.blue::shadow .circle {
      border-color: #4285f4;
      color: red;
    }
    .direction {
      margin: 3px;
    }
    .direction:hover {
     color: #03a9f4; 
    }
    .icon {
    position: relative;
    color: #fff;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    opacity: 0.7;
    text-align: center;
    margin: 1.5px 1.5px 1.5px 1.5px;
    padding: 2px;
    }
    paper-input {
        --paper-input-container-focus-color: #03a9f4;
        --paper-input-container-invalid-color: green;
        --paper-input-container-input-color: black;
    }
    paper-dropdown-menu {
      --paper-dropdown-menu-input-color: #03a9f4;
    }
    paper-fab {
      --paper-fab-background: #03a9f4;
      --paper-fab-keyboard-focus-background: red;
      position: relative; 
      right:-40%;
    }
    </style>
  
    
    <template>
      

      <paper-fab icon="add" on-tap="showAddTaskDialog3" style="text-align: center;"></paper-fab>

      <paper-dialog id="addTaskDialog" modal>
                <h2 class="add">Add connection</h2>
                <div><paper-input label="Connection station :" value="{{item.pathname}}">
                </paper-input>
                 <paper-input label="Arrival point :" value="">
                 </paper-input>

                 <paper-dropdown-menu label="Line" style="width:80px;">
                  <paper-listbox class="dropdown-content">
                    <paper-item>A</paper-item>
                    <paper-item>B</paper-item>
                    <paper-item>C</paper-item>
                    <paper-item>16</paper-item>
                  </paper-listbox></div>
                </paper-dropdown-menu>

                <div>
                    <paper-button dialog-dismiss>Cancel</paper-button>
                    <paper-button on-click="addTask">Add</paper-button>
                </div>
            </paper-dialog>

            <paper-dialog id="addTaskDialog2" modal>
                <h2 class="add">Alternative path</h2>
                <p>Select your preferences for the alternative path</p>
                <div style="text-align: center;"><iron-icon class="direction" icon="maps:directions-subway"></iron-icon>
                  <iron-icon class="direction" icon="maps:directions-bus"></iron-icon>
                <iron-icon class="direction" icon="maps:directions-bike"></iron-icon>
                <iron-icon class="direction" icon="maps:directions-walk"></iron-icon></div>
                
                    <paper-button dialog-dismiss>Cancel</paper-button>
                    <paper-button on-click="validate">Ok</paper-button>
                </div>
            </paper-dialog>

            <paper-dialog id="addTaskDialog3" modal>
                <h2 class="add">Add new path</h2>
                <div><paper-input label="Starting point :" value="{{item.pathname}}">
                </paper-input>
                 <paper-input label="Arrival point :" value="">
                 </paper-input>

                 <paper-dropdown-menu label="Line" style="width:80px;">
                  <paper-listbox class="dropdown-content">
                    <paper-item>A</paper-item>
                    <paper-item>B</paper-item>
                    <paper-item>C</paper-item>
                    <paper-item>16</paper-item>
                  </paper-listbox></div>
                </paper-dropdown-menu>

                <div>
                    <paper-button dialog-dismiss>Cancel</paper-button>
                    <paper-button on-click="addTask">Add</paper-button>
                </div>
            </paper-dialog>


    <post-service id="service" posts="{{posts}}"></post-service>


    <div layout="" vertical="" center="">
      <template is="dom-repeat" items="[[posts]]">
        <post-card favorite="{{item.favorite}}" on-favorite-tap="handleFavorite" deleted="item.deteted" on-deleted-tap="removeItem" filter="isDeleted" hidden="{{_computeHidden(item, show)}}">

          <h3><span>{{item.day}}</span></h3>
          <h4><span>{{item.time}}</span></h4>
          <!--<img src="{{post.avatar}}" width="70" height="70">-->
          
          <div vertical="" layout="" class="ligne"> <!-- Done in a static way, to improve to dynamic way -->
            <div class="icon" style="background-color: red;" hidden="{{_computeHidden2(item)}}">B</div>
            <div class="icon" style="background-color: purple;" hidden="{{_computeHidden3(item)}}">A</div>
            <div class="icon" style="background-color: #01B0F0;" hidden="{{_computeHidden4(item)}}">C</div>
            <div class="icon" style="background-color: purple;" hidden="{{_computeHidden5(item)}}">16</div>
            <div class="icon" style="background-color: red;" hidden="{{_computeHidden6(item)}}">B</div>
            <div class="icon" style="background-color: purple;" hidden="{{_computeHidden6(item)}}">A</div>
          </div>
      
          
          <h2><span>{{item.pathname}}</span></h2>
          <h5><span>{{item.direction}}</span></h5>
          <paper-icon-button connection="{{post.connection}}" id="connectionicon" icon="attachment" title="Connection" on-tap="showAddTaskDialog"><h5><span>{{item.connStation}}</span></h5>
          </paper-icon-button>
          <paper-icon-button id="alert" icon="trending-up" title="Alternative path ?" on-tap="showAddTaskDialog2" hidden="{{!item.breakdown}}">
        </paper-icon-button>

      </post-card>
      </template>
    </div>
  </template>
  <script>
    Polymer({
      is: 'post-list',
      properties: {
        connection: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        },
        show: { type: String, notify: true, value: "0" },
        
      },
      handleFavorite: function (e) {
        var model = e.model;
        model.set('item.favorite', (model.item.favorite));
        console.log('Favorite changed of pid : ' + model.item.pid + ', to ' + model.item.favorite);
      },
      handleDeleted: function (e) {
        var model = e.model;
        model.set('item.deleted', (!model.item.deleted));
        console.log('Delete changed of pid : ' + model.item.pid + ', to ' + model.item.deleted);
      },
      removeItem: function(e){
        var model = e.model;
        model.set('item.deleted', (!model.item.deleted));
       this.splice('posts', model.selectedItem, 1);
       console.log('Delete changed of pid : ' + model.item.pid + ', to ' + model.item.deleted);
       /*this.splice('posts', 0, 0, '7');*/
      /*this.items.push({pathname: 'Hey-How'});*/
      },
      isDeleted: function(item) {
      return item.deleted == 'true';
      },
      /*handleFavorite: function (event, detail, sender) {
        var dataHost = (this.dataHost && this.dataHost._rootDataHost) || this.dataHost;
        var item = sender.dataHost.item;
        this.$.service.setFavorite(item.pid, item.favorite);
      },*/
      showAddTaskDialog: function() {
        console.log('Add connection');
        this.$.addTaskDialog.toggle();
      },
      showAddTaskDialog2: function() {
        console.log('Alternative path computing');
        this.$.addTaskDialog2.toggle();
      },
      showAddTaskDialog3: function() {
        console.log('Adding new path');
        this.$.addTaskDialog3.toggle();
      },
      _computeHidden: function (post, show) {
        return post.deleted || (show == '1' && !post.favorite);
      },
      _computeHidden2: function (post) {
        return post.line != 'B';
      },
      _computeHidden3: function (post) {
        return post.line != 'A';
      },
      _computeHidden4: function (post) {
        return post.line != 'C';
      },
      _computeHidden5: function (post) {
        return post.line != '16';
      },
      _computeHidden6: function (post) {
        return post.line != 'BA';
      }
    });
  </script>
</dom-module>
